{"version":4,"terraform_version":"1.11.4","serial":18,"lineage":"746a79a7-745e-0776-9a30-fa27a10cfb28","outputs":{"ssh_command":{"value":"ssh ubuntu@10.100.0.14","type":"string"},"vm_ip":{"value":"10.100.0.14","type":"string"},"vm_name":{"value":"wug-infoblox-sync","type":"string"}},"resources":[{"mode":"managed","type":"local_file","name":"wug_sync_userdata","provider":"provider[\"registry.opentofu.org/hashicorp/local\"]","instances":[{"schema_version":0,"attributes":{"content":"#cloud-config\nhostname: wug-infoblox-sync\nfqdn: wug-infoblox-sync.lab.local\n\n# System configuration for default user\nsystem_info:\n  default_user:\n    name: ubuntu\n    plain_text_passwd: ubuntu123!\n    lock_passwd: false\n    sudo: ALL=(ALL) NOPASSWD:ALL\n    shell: /bin/bash\n\n# User configuration\nusers:\n  - name: ubuntu\n    plain_text_passwd: ubuntu123!\n    shell: /bin/bash\n    sudo: ALL=(ALL) NOPASSWD:ALL\n    lock_passwd: false\n    home: /home/ubuntu\n    ssh_authorized_keys:\n      - ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQC1wlEJjUsVXEYS5idK1OabkI5hcYOEmV3QXVREOvdL1IOdfu0vCMZ/UYok89euzuXY8Ry9KGItWG1jdVVi8v7810sEC4yAUxfeTIQx1r4T789fhLzzYWxFzxdsw3F6oyU4DmUdnR4xQg7/ZH3/jd31Ei+GRFKgxL2S8wERZOkMygwRRzlatYoNYNhsUr3x71cJu8lkXYazIwMNAOi1pfA4iXTzBDqESJpqOHecclFxNs7QjuFME/CQiHVn0zYq/ewuR0Y2hdcGkDsZNO1DfrtxaMGasNLBxno+HvLut1pUiqgOG5G5NmTO0kkp2l0HpIxjXLtTMDK6p1E3hBkhQARhAiuKrD0nXynI4lktpqUf/tI9HxL0GPtFFPda6rVuw/9Y0RWRRXhqlZ7d6xHADyMdjHU1Ec3cwEZEPhYOE51dR3jtvEh+TZUHpmQaIXWNPMGwUV0/2V4JhpOPqCJKBVMCTF71mwlXPV7mGH/EMfKDlYL/EdhOTAM0Dc8wAn9lW0EPSbUGsfR8+4BAAD65pSMVAIPoBbMpP5BRlmIDlBXH/C/vqUSLolGnEtH+D+ML07ow5Kn/FIYzkSMnoAH/38v0mD2YXNab6MYPF4j4L7zkIFecUjohD+O/nG7LKZ+KUMxbGoiQY9jMVRIzNyL2HFXX4cAUd8WY5jqKh3stJaF8nw== ubuntu@chef-dev\n\n# Enable password authentication\nssh_pwauth: true\n\n# Set password using multiple methods for reliability\nchpasswd:\n  expire: false\n  users:\n    - name: ubuntu\n      password: ubuntu123!\n      type: text\n\n# Network configuration for static IP\nwrite_files:\n  - path: /etc/cloud/cloud.cfg.d/99-disable-network-config.cfg\n    content: |\n      network: {config: disabled}\n    permissions: '0644'\n  - path: /etc/netplan/99-netcfg.yaml\n    content: |\n      network:\n        version: 2\n        ethernets:\n          eth0:\n            dhcp4: false\n            addresses:\n              - 10.100.0.14/14\n            routes:\n              - to: default\n                via: 10.100.0.1\n            nameservers:\n              addresses:\n                - 8.8.8.8,8.8.4.4\n    permissions: '0644'\n  - path: /etc/hosts.append\n    content: |\n      10.100.0.11 wug.local\n      10.100.0.14 infoblox.local\n    permissions: '0644'\n  - path: /etc/systemd/system/wug-infoblox-sync.service\n    permissions: '0644'\n    content: |\n      [Unit]\n      Description=WhatsUp Gold to Infoblox Sync Service\n      After=network-online.target\n      Wants=network-online.target\n\n      [Service]\n      Type=simple\n      User=ubuntu\n      WorkingDirectory=/opt/wug-infoblox-sync\n      Environment=\"PATH=/opt/wug-infoblox-sync/.venv/bin:/usr/local/bin:/usr/bin:/bin\"\n      ExecStart=/opt/wug-infoblox-sync/.venv/bin/python -m wug_infoblox_sync.app\n      Restart=always\n      RestartSec=10\n\n      [Install]\n      WantedBy=multi-user.target\n  - path: /opt/wug-infoblox-sync.env\n    permissions: '0600'\n    content: |\n      FLASK_HOST=0.0.0.0\n      FLASK_PORT=8080\n      SYNC_TIMEOUT_SECONDS=30\n      SYNC_VERIFY_SSL=false\n      SYNC_LOG_LEVEL=INFO\n      \n      WUG_BASE_URL=https://wug.local:9644\n      WUG_USERNAME=api_user\n      WUG_PASSWORD=apiuser123!\n      WUG_TOKEN_ENDPOINT=/api/v1/token\n      \n      INFOBLOX_BASE_URL=https://infoblox.local\n      INFOBLOX_WAPI_VERSION=v2.12.3\n      INFOBLOX_USERNAME=admin\n      INFOBLOX_PASSWORD=admin123!\n      INFOBLOX_NETWORK_VIEW=default\n      INFOBLOX_DRY_RUN=true\n\n# Update packages\npackage_update: true\npackage_upgrade: true\n\n# Install required packages\npackages:\n  - git\n  - python3\n  - python3-pip\n  - python3-venv\n  - curl\n  - wget\n  - unzip\n  - jq\n  - vim\n  - openssh-server\n  - cloud-guest-utils\n\n# Run commands at boot\nruncmd:\n  # Disk expansion - ensure we use all allocated disk space\n  - growpart /dev/sda 3 || true\n  - pvresize /dev/sda3 || true\n  - lvextend -l +100%FREE /dev/ubuntu-vg/ubuntu-lv || true\n  - resize2fs /dev/ubuntu-vg/ubuntu-lv || true\n  # Network setup\n  - netplan apply\n  - systemctl restart systemd-networkd\n  # Add custom hosts entries\n  - cat /etc/hosts.append \u003e\u003e /etc/hosts\n  # User setup - multiple attempts for reliability\n  - echo 'ubuntu:ubuntu123!' | chpasswd\n  - passwd -u ubuntu\n  - usermod -aG sudo ubuntu\n  - usermod -s /bin/bash ubuntu\n  - mkdir -p /home/ubuntu/.ssh\n  - chown ubuntu:ubuntu /home/ubuntu/.ssh\n  - chmod 700 /home/ubuntu/.ssh\n  # SSH setup\n  - systemctl enable ssh\n  - systemctl start ssh\n  - systemctl restart ssh\n  # Enable console login\n  - systemctl enable getty@tty1.service\n  - systemctl start getty@tty1.service\n  # Clone and setup WUG-Infoblox sync service\n  - cd /opt\n  - git clone https://github.com/bassslap/wug-infoblox-sync.git\n  - cd wug-infoblox-sync\n  - python3 -m venv .venv\n  - /opt/wug-infoblox-sync/.venv/bin/pip install --upgrade pip\n  - /opt/wug-infoblox-sync/.venv/bin/pip install -e .\n  # Move pre-configured .env into place\n  - mv /opt/wug-infoblox-sync.env /opt/wug-infoblox-sync/.env\n  - chown -R ubuntu:ubuntu /opt/wug-infoblox-sync\n  - chmod 600 /opt/wug-infoblox-sync/.env\n  # Enable and start service\n  - systemctl daemon-reload\n  - systemctl enable wug-infoblox-sync.service\n  - systemctl start wug-infoblox-sync.service\n  # Debug logging\n  - echo \"WUG-Infoblox sync setup completed at $(date)\" \u003e\u003e /var/log/setup-debug.log\n  - id ubuntu \u003e\u003e /var/log/setup-debug.log\n  - grep ubuntu /etc/passwd \u003e\u003e /var/log/setup-debug.log\n  - systemctl status wug-infoblox-sync \u003e\u003e /var/log/setup-debug.log\n\n# SSH configuration\nssh_deletekeys: false\nssh_genkeytypes: ['rsa', 'ecdsa', 'ed25519']\n\n# Console access\ndisable_root: false\nssh_authorize_keys: true\n\n# Final message\nfinal_message: \"***HEY-YOU!*** WUG-Infoblox Sync VM ready at 10.100.0.14:8080. Login: ubuntu/ubuntu123! Service auto-started.\"\n","content_base64":null,"content_base64sha256":"g3NdTZenCi3D33fKuqKtPCAsuYtE+CzihzJI74eA8Bo=","content_base64sha512":"uevh4n55Jx3+UWTBXX7D7q7urevEJgaYWnFcNhZ7p5mTc6ZF5PrrXGe7Kctp5OGpEOt7zJMGfw+LkLjsRKfhEA==","content_md5":"d531b274e08801fa2440f81dbdccba45","content_sha1":"738ffce1ad65b77971ab054230e23ab2460fcaaa","content_sha256":"83735d4d97a70a2dc3df77cabaa2ad3c202cb98b44f82ce2873248ef8780f01a","content_sha512":"b9ebe1e27e79271dfe5164c15d7ec3eeaeeeadebc42606985a715c36167ba7999373a645e4faeb5c67bb29cb69e4e1a910eb7bcc93067f0f8b90b8ec44a7e110","directory_permission":"0777","file_permission":"0777","filename":"./tmp/wug-sync-userdata.yml","id":"738ffce1ad65b77971ab054230e23ab2460fcaaa","sensitive_content":null,"source":null},"sensitive_attributes":[[{"type":"get_attr","value":"content"}],[{"type":"get_attr","value":"sensitive_content"}]]}]},{"mode":"managed","type":"null_resource","name":"copy_snippet_to_proxmox","provider":"provider[\"registry.opentofu.org/hashicorp/null\"]","instances":[{"schema_version":0,"attributes":{"id":"4292744894312968664","triggers":{"src_hash":"83735d4d97a70a2dc3df77cabaa2ad3c202cb98b44f82ce2873248ef8780f01a"}},"sensitive_attributes":[[{"type":"get_attr","value":"triggers"},{"type":"index","value":{"value":"src_hash","type":"string"}}]],"dependencies":["local_file.wug_sync_userdata"]}]},{"mode":"managed","type":"proxmox_virtual_environment_vm","name":"wug_sync","provider":"provider[\"registry.opentofu.org/bpg/proxmox\"]","instances":[{"schema_version":0,"attributes":{"acpi":true,"agent":[{"enabled":true,"timeout":"15m","trim":true,"type":"virtio","wait_for_ip":[]}],"amd_sev":[],"audio_device":[],"bios":"seabios","boot_order":["scsi0","net0"],"cdrom":[],"clone":[{"datastore_id":"","full":true,"node_name":"","retries":1,"vm_id":9001}],"cpu":[{"affinity":"","architecture":"","cores":2,"flags":null,"hotplugged":0,"limit":0,"numa":false,"sockets":1,"type":"x86-64-v2-AES","units":0}],"delete_unreferenced_disks_on_destroy":true,"description":"WhatsUp Gold to Infoblox IPAM Sync Service","disk":[{"aio":"io_uring","backup":true,"cache":"none","datastore_id":"local-4tb","discard":"ignore","file_format":"qcow2","file_id":"","import_from":"","interface":"scsi0","iothread":true,"path_in_datastore":"402/vm-402-disk-0.qcow2","replicate":true,"serial":"","size":32,"speed":[],"ssd":false}],"efi_disk":[],"hook_script_file_id":null,"hostpci":[],"hotplug":null,"id":"402","initialization":[{"datastore_id":"local-lvm","dns":[{"domain":"lab.local","servers":["8.8.8.8","8.8.4.4"]}],"file_format":"","interface":"ide2","ip_config":[{"ipv4":[{"address":"10.100.0.14/14","gateway":"10.100.0.1"}],"ipv6":[]}],"meta_data_file_id":"","network_data_file_id":"","type":"","user_account":[{"keys":["ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQC1wlEJjUsVXEYS5idK1OabkI5hcYOEmV3QXVREOvdL1IOdfu0vCMZ/UYok89euzuXY8Ry9KGItWG1jdVVi8v7810sEC4yAUxfeTIQx1r4T789fhLzzYWxFzxdsw3F6oyU4DmUdnR4xQg7/ZH3/jd31Ei+GRFKgxL2S8wERZOkMygwRRzlatYoNYNhsUr3x71cJu8lkXYazIwMNAOi1pfA4iXTzBDqESJpqOHecclFxNs7QjuFME/CQiHVn0zYq/ewuR0Y2hdcGkDsZNO1DfrtxaMGasNLBxno+HvLut1pUiqgOG5G5NmTO0kkp2l0HpIxjXLtTMDK6p1E3hBkhQARhAiuKrD0nXynI4lktpqUf/tI9HxL0GPtFFPda6rVuw/9Y0RWRRXhqlZ7d6xHADyMdjHU1Ec3cwEZEPhYOE51dR3jtvEh+TZUHpmQaIXWNPMGwUV0/2V4JhpOPqCJKBVMCTF71mwlXPV7mGH/EMfKDlYL/EdhOTAM0Dc8wAn9lW0EPSbUGsfR8+4BAAD65pSMVAIPoBbMpP5BRlmIDlBXH/C/vqUSLolGnEtH+D+ML07ow5Kn/FIYzkSMnoAH/38v0mD2YXNab6MYPF4j4L7zkIFecUjohD+O/nG7LKZ+KUMxbGoiQY9jMVRIzNyL2HFXX4cAUd8WY5jqKh3stJaF8nw== ubuntu@chef-dev"],"password":"**********","username":"ubuntu"}],"user_data_file_id":"local:snippets/wug-sync-userdata.yml","vendor_data_file_id":""}],"ipv4_addresses":[["127.0.0.1"],["10.100.0.14"]],"ipv6_addresses":[["::1"],["fe80::be24:11ff:fe29:ee3f"]],"keyboard_layout":"en-us","kvm_arguments":null,"mac_addresses":["00:00:00:00:00:00","BC:24:11:29:EE:3F"],"machine":null,"memory":[{"dedicated":2048,"floating":0,"hugepages":"","keep_hugepages":false,"shared":0}],"migrate":false,"name":"wug-infoblox-sync","network_device":[{"bridge":"vmbr0","disconnected":false,"enabled":true,"firewall":false,"mac_address":"BC:24:11:29:EE:3F","model":"virtio","mtu":0,"queues":0,"rate_limit":0,"trunks":"","vlan_id":0}],"network_interface_names":["lo","eth0"],"node_name":"pve","numa":[],"on_boot":true,"operating_system":[{"type":"l26"}],"pool_id":"","protection":false,"purge_on_destroy":true,"reboot":false,"reboot_after_update":true,"rng":[],"scsi_hardware":"virtio-scsi-pci","serial_device":[],"smbios":[],"started":true,"startup":[],"stop_on_destroy":true,"tablet_device":true,"tags":["automation","infoblox","wug-sync"],"template":false,"timeout_clone":1800,"timeout_create":1800,"timeout_migrate":1800,"timeout_move_disk":1800,"timeout_reboot":1800,"timeout_shutdown_vm":1800,"timeout_start_vm":1800,"timeout_stop_vm":300,"tpm_state":[],"usb":[],"vga":[],"virtiofs":[],"vm_id":402,"watchdog":[]},"sensitive_attributes":[[{"type":"get_attr","value":"initialization"},{"type":"index","value":{"value":0,"type":"number"}},{"type":"get_attr","value":"user_account"},{"type":"index","value":{"value":0,"type":"number"}},{"type":"get_attr","value":"password"}]],"private":"bnVsbA==","dependencies":["local_file.wug_sync_userdata","null_resource.copy_snippet_to_proxmox"]}]}],"check_results":null}
